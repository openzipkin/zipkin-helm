# Zipkin Helm Chart

[![Gitter Chat](http://img.shields.io/badge/gitter-join%20chat%20%E2%86%92-brightgreen.svg)](https://gitter.im/openzipkin/zipkin)
[![Build Status](https://github.com/openzipkin/zipkin-helm/workflows/test/badge.svg)](https://github.com/openzipkin/zipkin-helm/actions?query=workflow%3Atest)

## Usage

[Helm](https://helm.sh) must be installed to use the charts.
Please refer to Helm's [documentation](https://helm.sh/docs/) to get started.

Once Helm is set up properly, add the repo as follows:

```console
$ helm repo add zipkin https://zipkin.io/zipkin-helm
```

You can then run `helm search repo zipkin` to see the charts.

## Values

| Key                                        | Type   | Default                            | Description                                                                                                                                                                                                                                                                                                                                  |
|--------------------------------------------|--------|------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| affinity                                   | object | `{}`                               |                                                                                                                                                                                                                                                                                                                                              |
| args                                       | list   | `[]`                               | arguments to the zipkin start command                                                                                                                                                                                                                                                                                                        |
| autoscaling.enabled                        | bool   | `false`                            |                                                                                                                                                                                                                                                                                                                                              |
| autoscaling.maxReplicas                    | int    | `100`                              |                                                                                                                                                                                                                                                                                                                                              |
| autoscaling.minReplicas                    | int    | `1`                                |                                                                                                                                                                                                                                                                                                                                              |
| autoscaling.targetCPUUtilizationPercentage | int    | `80`                               |                                                                                                                                                                                                                                                                                                                                              |
| command                                    | list   | `["start-zipkin"]`                 | command used to start zipkin                                                                                                                                                                                                                                                                                                                 |
| fullnameOverride                           | string | `""`                               |                                                                                                                                                                                                                                                                                                                                              |
| image.pullPolicy                           | string | `"IfNotPresent"`                   |                                                                                                                                                                                                                                                                                                                                              |
| image.repository                           | string | `"openzipkin/zipkin-slim"`         |                                                                                                                                                                                                                                                                                                                                              |
| image.tag                                  | string | `""`                               |                                                                                                                                                                                                                                                                                                                                              |
| imagePullSecrets                           | list   | `[]`                               |                                                                                                                                                                                                                                                                                                                                              |
| ingress.annotations                        | object | `{}`                               |                                                                                                                                                                                                                                                                                                                                              |
| ingress.enabled                            | bool   | `false`                            |                                                                                                                                                                                                                                                                                                                                              |
| ingress.host                               | string | `"chart-example.local"`            | kubernetes.io/tls-acme: "true" className: nginx                                                                                                                                                                                                                                                                                              |
| ingress.path                               | string | `"/"`                              |                                                                                                                                                                                                                                                                                                                                              |
| ingress.tls                                | list   | `[]`                               |                                                                                                                                                                                                                                                                                                                                              |
| nameOverride                               | string | `""`                               |                                                                                                                                                                                                                                                                                                                                              |
| namespaceOverride                          | string | release namespace                  | Namespace to create the zipkin resources in                                                                                                                                                                                                                                                                                                  |
| nodeSelector                               | object | `{}`                               |                                                                                                                                                                                                                                                                                                                                              |
| podAnnotations."sidecar.istio.io/inject"   | string | `"false"`                          |                                                                                                                                                                                                                                                                                                                                              |
| podSecurityContext                         | object | `{}`                               |                                                                                                                                                                                                                                                                                                                                              |
| priorityClassName                          | string | `""`                               | priority class name for the Pod                                                                                                                                                                                                                                                                                                              |
| replicaCount                               | int    | `1`                                |                                                                                                                                                                                                                                                                                                                                              |
| resources.limits                           | object | `{"cpu":"500m","memory":"4096Mi"}` | choice for the user. This also increases chances charts run on environments with little resources, such as Minikube. If you do want to specify resources, uncomment the following lines, adjust them as necessary, and remove the curly braces after 'resources:'. limits:   cpu: 100m   memory: 128Mi requests:   cpu: 100m   memory: 128Mi |
| resources.requests.cpu                     | string | `"100m"`                           |                                                                                                                                                                                                                                                                                                                                              |
| resources.requests.memory                  | string | `"128Mi"`                          |                                                                                                                                                                                                                                                                                                                                              |
| securityContext.readOnlyRootFilesystem     | bool   | `true`                             | drop:   - ALL                                                                                                                                                                                                                                                                                                                                |
| securityContext.runAsNonRoot               | bool   | `true`                             |                                                                                                                                                                                                                                                                                                                                              |
| securityContext.runAsUser                  | int    | `1000`                             |                                                                                                                                                                                                                                                                                                                                              |
| service.port                               | int    | `9411`                             |                                                                                                                                                                                                                                                                                                                                              |
| service.type                               | string | `"ClusterIP"`                      |                                                                                                                                                                                                                                                                                                                                              |
| service.annotations                        | object | `{}`                               |                                                                                                                                                                                                                                                                                                                                              |
| serviceAccount.annotations                 | object | `{}`                               |                                                                                                                                                                                                                                                                                                                                              |
| serviceAccount.create                      | bool   | `true`                             |                                                                                                                                                                                                                                                                                                                                              |
| serviceAccount.name                        | string | `""`                               | If not set and create is true, a name is generated using the fullname template                                                                                                                                                                                                                                                               |
| serviceAccount.psp                         | bool   | `false`                            |                                                                                                                                                                                                                                                                                                                                              |
| serviceMonitor.enabled                     | bool   | `false`                            | Creates a ServiceMonitor to scrape /prometheus. Requires prometheus-operator                                                                                                                                                                                                                                                                 |
| serviceMonitor.namespace                   | string | override or release namespace      | Namespace to create the service monitor in                                                                                                                                                                                                                                                                                                   |
| serviceMonitor.labels                      | object | `{}`                               | Additional metadata labels                                                                                                                                                                                                                                                                                                                   |
| serviceMonitor.interval                    | string | Prometheus global scrape interval  | How often to scrape /prometheus. e.g. '5s'                                                                                                                                                                                                                                                                                                   |
| serviceMonitor.scrapeTimeout               | string | Prometheus global scrape timeout   | Timeout for scraping metrics. e.g. '10s'                                                                                                                                                                                                                                                                                                     |
| tolerations                                | list   | `[]`                               |                                                                                                                                                                                                                                                                                                                                              |
| zipkin.discovery.eureka.serviceUrl         | string | no default                         | v2 endpoint of Eureka, e.g. `https://eureka-prod/eureka/v2`                                                                                                                                                                                                                                                                                  |
| zipkin.discovery.eureka.app                | string | `"zipkin"`                         | The application this instance registers to                                                                                                                                                                                                                                                                                                   |
| zipkin.discovery.eureka.hostName           | string | detects                            | The instance `hostName` and `vipAddress`                                                                                                                                                                                                                                                                                                     |
| zipkin.discovery.eureka.instanceId         | string | `"hostName:app:port"`              |                                                                                                                                                                                                                                                                                                                                              |
| zipkin.storage.type                        | string | `"mem"`                            |                                                                                                                                                                                                                                                                                                                                              |
| zipkin.selfTracing.enabled                 | bool   | `false`                            |                                                                                                                                                                                                                                                                                                                                              |
| zipkin.storage.elasticsearch.hosts         | string | no default                         |                                                                                                                                                                                                                                                                                                                                              |
| zipkin.storage.elasticsearch.index         | string | `"zipkin"`                         |                                                                                                                                                                                                                                                                                                                                              |
| zipkin.storage.elasticsearch.sslNoVerify   | bool   | `false`                            | Disables server key certificate chain verification. Not appropriate for production.                                                                                                                                                                                                                                                          |
| zipkin.storage.elasticsearch.username      | string | no default                         | Basic authentication of X-Pack security                                                                                                                                                                                                                                                                                                      |
| zipkin.storage.elasticsearch.password      | string | no default                         | Basic authentication of X-Pack security                                                                                                                                                                                                                                                                                                      |
| zipkin.storage.type                        | string | `"mem"`                            |                                                                                                                                                                                                                                                                                                                                              |
| extraManifests                    | list | `[]` |   Extra manifests to deploy with the helm chart |



The values are validated using a JSON schema, which contains logic to enforce either:

- `zipkin.storage.type` is set to `mem`
- `zipkin.storage.type` is set to `elasticsearch` *AND* `z.s.elasticsearch.hosts` is set
